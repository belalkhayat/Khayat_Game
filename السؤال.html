<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>ذكاء × سرعة - السؤال</title>
  <style>
    body {
      font-family: 'Baloo 2', cursive;
      direction: rtl;
      background: linear-gradient(to bottom right, #e0f7fa, #d0f5e8);
      margin: 0; padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      background: #ffffffcc;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 0 15px #999;
      width: 90%;
      max-width: 800px;
      text-align: center;
    }
    .btn {
      padding: 12px 25px;
      margin: 5px;
      font-size: 1.1em;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }
    .btn-primary { background: #00796b; color: white; }
    .btn-danger  { background: #c0392b; color: white; }
    .btn-secondary { background: #2980b9; color: white; }
    .btn-info { background: #16a085; color: white; }
    .btn-warning { background: #f39c12; color: white; }
    .help-buttons { margin: 15px 0; }
    .team-turn, .points {
      font-size: 1.3em;
      color: #004d40;
      font-weight: bold;
    }
    .question {
      font-size: 1.6em;
      margin: 20px 0;
      color: #004d40;
    }
    #answer-box, #luck-result {
      margin-top: 20px;
      font-size: 1.4em;
      color: #004d40;
      display: none;
    }
    #audience-status {
      font-size: 1.3em;
      font-weight: bold;
      color: #8e44ad;
      display: none;
    }
    #audience-chart {
      display: none;
      margin-top: 20px;
    }
    #countdown {
      margin-top: 10px;
      font-size: 1.2em;
      color: #c0392b;
      font-weight: bold;
    }
    .bar {
      height: 28px;
      background-color: #16a085;
      margin: 10px 0;
      border-radius: 10px;
      color: white;
      padding-right: 10px;
      font-weight: bold;
      text-align: right;
    }
    .rolling {
      animation: roll 0.6s infinite alternate;
      color: #8e44ad;
    }
    @keyframes roll {
      from { transform: scale(1); opacity: 0.6; }
      to { transform: scale(1.2); opacity: 1; }
    }
    @keyframes flashText {
      from { opacity: 0.5; }
      to   { opacity: 1; transform: scale(1.05); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="team-turn" id="team-turn"></div>
    <div class="points" id="points"></div>

    <div class="help-buttons">
      <button class="btn btn-info" id="audience-btn">🎤 الجمهور</button>
      <button class="btn btn-warning" id="luck-btn">🎲 نرد الحظ</button>
    </div>

    <div class="question" id="question-text">السؤال هنا</div>
    <button class="btn btn-secondary" id="show-answer-btn">👁️ إظهار الجواب</button>
    <div id="answer-box"></div>
    <div id="luck-result"></div>
    <audio id="crowd-sound" src="crowd.mp3"></audio>
    <div id="audience-status">📊 جارٍ جمع آراء الجمهور...</div>
    <div id="audience-chart"></div>
    <div id="countdown"></div>

    <div style="margin-top: 20px;">
      <button class="btn btn-primary" id="correct-btn">✅ إجابة صحيحة</button>
      <button class="btn btn-danger" id="wrong-btn">❌ إجابة خاطئة</button>
    </div>
  </div>
<script>
  const currentTeam = parseInt(sessionStorage.getItem("currentTeam")) || 1;
  const points = parseInt(sessionStorage.getItem("currentPoints")) || 200;
  const correctAnswer = sessionStorage.getItem("currentAnswer") || "...";
  const question = sessionStorage.getItem("currentQuestion") || "...";
  const team1 = sessionStorage.getItem("team1") || "فريق 1";
  const team2 = sessionStorage.getItem("team2") || "فريق 2";

  document.getElementById("team-turn").textContent = `دور الفريق: ${currentTeam === 1 ? team1 : team2}`;
  document.getElementById("points").textContent = `النقاط: ${points}`;
  document.getElementById("question-text").textContent = question;

  document.getElementById("show-answer-btn").addEventListener("click", () => {
    const box = document.getElementById("answer-box");
    box.textContent = `الإجابة الصحيحة: ${correctAnswer}`;
    box.style.display = "block";
  });

  // اسأل الجمهور
  document.getElementById("audience-btn").addEventListener("click", () => {
    const key = currentTeam === 1 ? "team1UsedAudience" : "team2UsedAudience";
    if (sessionStorage.getItem(key) === "true") {
      alert("❌ تم استخدام الجمهور مسبقاً");
      return;
    }
    sessionStorage.setItem(key, "true");

    const chart = document.getElementById("audience-chart");
    const countdown = document.getElementById("countdown");
    const status = document.getElementById("audience-status");
    const audio = document.getElementById("crowd-sound");

    chart.innerHTML = "";
    chart.style.display = "none";

    status.style.display = "block";
    status.style.animation = "flashText 0.5s ease-in-out infinite alternate";
    audio.play();

    setTimeout(() => {
      status.style.display = "none";
      status.style.animation = "none";
      chart.style.display = "block";

      const options = ["أ", "ب", "ج", "د"];
      const correctIndex = Math.floor(Math.random() * 4);
      const votes = [0, 0, 0, 0];
      votes[correctIndex] = 55 + Math.floor(Math.random() * 16);
      let remaining = 100 - votes[correctIndex];
      const others = [0, 1, 2, 3].filter(i => i !== correctIndex);
      for (let i = 0; i < others.length; i++) {
        const share = i < others.length - 1 ? Math.floor(Math.random() * (remaining + 1)) : remaining;
        votes[others[i]] = share;
        remaining -= share;
      }

      options.forEach((label, i) => {
        const bar = document.createElement("div");
        bar.className = "bar";
        bar.style.width = votes[i] + "%";
        bar.textContent = `${label}: ${votes[i]}٪`;
        chart.appendChild(bar);
      });

      let seconds = 10;
      countdown.textContent = `⏳ ${seconds} ثانية...`;
      const timer = setInterval(() => {
        seconds--;
        countdown.textContent = `⏳ ${seconds} ثانية...`;
        if (seconds <= 0) {
          clearInterval(timer);
          chart.style.display = "none";
          countdown.textContent = "";
        }
      }, 1000);
    }, 2000);
  });
</script>
</body>
</html>


<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ø°ÙƒØ§Ø¡ X Ø³Ø±Ø¹Ø©</title>
  <style>
    body {
      font-family: 'Baloo 2', cursive;
      direction: rtl;
      background: linear-gradient(to bottom right, #a0e9ff, #b8f2d9);
      padding: 40px;
      text-align: center;
    }

    .category-group {
      margin-bottom: 30px;
    }

    .group-title {
      font-size: 1.4em;
      font-weight: bold;
      color: #064d4d;
      margin-bottom: 10px;
      border-bottom: 2px dashed #064d4d;
      display: inline-block;
      padding-bottom: 5px;
    }

    .category-box {
      display: inline-block;
      margin: 8px;
      padding: 15px 25px;
      border-radius: 20px;
      background: #09a09a;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }

    .category-box.selected {
      background: #064d4d;
    }

    .category-box.disabled {
      background: #999;
      color: #ccc;
      cursor: not-allowed;
      opacity: 0.6;
    }

    input[type="text"] {
      padding: 10px;
      font-size: 1em;
      margin: 10px;
      border-radius: 10px;
      border: 2px solid #09a09a;
    }

    button {
      padding: 15px 30px;
      font-size: 1.2em;
      margin: 15px;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      color: white;
    }

    #start-btn {
      background-color: #064d4d;
    }

    #reset-btn {
      background-color: #c0392b;
    }

    h2 {
      margin-top: 30px;
      color: #064d4d;
    }
  </style>
</head>
<body>

  <h1>Ø°ÙƒØ§Ø¡ X Ø³Ø±Ø¹Ø©</h1>

  <input type="text" id="team1-name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ 1" />
  <input type="text" id="team2-name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ 2" />

  <h2>Ø§Ø®ØªØ± Ø­ØªÙ‰ 6 ÙØ¦Ø§Øª (Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙ‚Ø·)</h2>
  <div id="categories-container"></div>

  <button id="start-btn">Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
  <button id="reset-btn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù† Ø§Ù„ØµÙØ±</button>

  <audio id="click-sound" src="click.mp3"></audio>

  <script>
    const clickSound = document.getElementById("click-sound");
    const categoriesContainer = document.getElementById("categories-container");

    const allCategories = {
      "Ø¥Ø³Ù„Ø§Ù…ÙŠØ©": ["Ø¯ÙŠÙ†", "Ù‚ØµØµ Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡", "Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ù†Ø¨ÙˆÙŠØ©"],
      "Ø£Ù†Ù…ÙŠ ÙˆÙ…Ø³Ù„Ø³Ù„Ø§Øª": ["Ù†Ø§Ø±ÙˆØªÙˆ", "ÙˆÙ† Ø¨ÙŠØ³", "ÙƒÙˆÙ†Ø§Ù†"],
      "ğŸ¬ ØªØ±ÙÙŠÙ‡ÙŠ": ["Ø£ÙÙ„Ø§Ù… ÙƒØ±ØªÙˆÙ† Ø²Ù…Ø§Ù†", "Ø°ÙƒØ§Ø¡ ÙˆØ³Ø±Ø¹Ø© Ø¨Ø¯ÙŠÙ‡Ø©"],
      "ğŸ§’ Ø£Ø·ÙØ§Ù„": ["Ø£Ø³Ø¦Ù„Ø© Ø±ÙŠØ§Ø¶ Ø£Ø·ÙØ§Ù„", "Ø­ÙŠÙˆØ§Ù†Ø§Øª", "ÙÙˆØ§ÙƒÙ‡ ÙˆØ®Ø¶Ø§Ø±"]
    };

    const maxPerLevel = 2;
    const levels = [200, 400, 600];
    let selectedCategories = [];
    let questionData = {};
    let usedQuestions = JSON.parse(sessionStorage.getItem("usedQuestions") || "{}");

    function calculateRemainingRounds(categoryName) {
      const levelCounts = levels.map(level => {
        const total = (questionData[categoryName]?.[level]?.length || 0);
        let used = 0;
        for (let i = 0; i < total; i++) {
          const key = `${categoryName}_${level}_${i}`;
          if (usedQuestions[key]) used++;
        }
        return total - used;
      });
      return Math.min(...levelCounts);
    }

    function renderCategories() {
      categoriesContainer.innerHTML = "";
      for (const groupName in allCategories) {
        const groupDiv = document.createElement("div");
        groupDiv.className = "category-group";

        const title = document.createElement("div");
        title.className = "group-title";
        title.textContent = groupName;
        groupDiv.appendChild(title);

        allCategories[groupName].forEach(cat => {
          const box = document.createElement("div");
          box.className = "category-box";

          const remainingRounds = calculateRemainingRounds(cat);
          box.textContent = `${cat} (${remainingRounds} Ø¬ÙˆÙ„Ø© Ù…ØªØ¨Ù‚ÙŠØ©)`;

          if (remainingRounds <= 0) {
            box.classList.add("disabled");
          } else {
            box.addEventListener("click", () => {
              clickSound.play();
              if (box.classList.contains("selected")) {
                box.classList.remove("selected");
                selectedCategories = selectedCategories.filter(c => c !== cat);
              } else {
                if (selectedCategories.length < 6) {
                  box.classList.add("selected");
                  selectedCategories.push(cat);
                } else {
                  alert("ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± 6 ÙØ¦Ø§Øª ÙÙ‚Ø·");
                }
              }
            });
          }

          groupDiv.appendChild(box);
        });

        categoriesContainer.appendChild(groupDiv);
      }
    }

    document.getElementById("start-btn").addEventListener("click", () => {
      clickSound.play();
      const name1 = document.getElementById("team1-name").value.trim();
      const name2 = document.getElementById("team2-name").value.trim();

      if (!name1 || !name2) {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ†");
        return;
      }

      if (selectedCategories.length !== 6) {
        alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± 6 ÙØ¦Ø§Øª ÙÙ‚Ø·");
        return;
      }

      sessionStorage.setItem("team1", name1);
      sessionStorage.setItem("team2", name2);
      sessionStorage.setItem("categories", JSON.stringify(selectedCategories));
      sessionStorage.setItem("team1Score", "0");
      sessionStorage.setItem("team2Score", "0");
      sessionStorage.setItem("currentTeam", "1");

      window.location.href = "board.html";
    });

    document.getElementById("reset-btn").addEventListener("click", () => {
      clickSound.play();
      if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù† Ø§Ù„ØµÙØ±ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©!")) {
        sessionStorage.clear();
        alert("ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø®ØªÙŠØ§Ø± ÙØ¦Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.");
        location.reload();
      }
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    fetch("questions.json")
      .then(res => res.json())
      .then(data => {
        questionData = data;
        sessionStorage.setItem("questionsDatabase", JSON.stringify(data));
        renderCategories();
      })
      .catch(err => {
        alert("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©");
        console.error(err);
      });
  </script>

</body>
</html>
